<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="ititle" content="Instructions for Building the OpenBSD Port of Tor Browser"/>
	<link type="text/css" rel="stylesheet" href="torbsd.css"/>
	<meta name="author" content="gman999"/>
	<meta name="date" content="20150509"/>
	<meta name="note" content="above is markdown data, edit or leave alone."/>
</head>
<body>

<h1 id="openbsdbuildtestboxfortorbrowser">OpenBSD Build/Test Box for Tor Browser</h1>

<p>Desktops are slow, servers are (supposed to be) fast. For those interested in doing more than just compiling the current version of OpenBSD Tor Browser, a full server configuration might be of-interest. This might include testing builds, keeping the port in-sync with the [GitHub repository]{https://github.com/torbsd/openbsd-ports), maintaining a current OpenBSD ports tree, creating and updating the package. This also requires keeping base operating system, the ports tree and the Tor Browser repository updated with each new build. </p>

<p>Assuming decent specs with multi-cores, &gt;8Gb of RAM</p>

<ul>
<li><p>Install OpenBSD snapshot</p></li>
<li><p>OpenBSD is sanely restrictive on how much resources each users can utilize. Therefore, it is necessary to make some system changes to allow something as collassal as building the Tor Browser on OpenBSD.</p></li>
<li><p>For partitions creation, do a manual setup.</p></li>
</ul>

<p>Add a separate partition for /usr/ports/pobj with 20G or so.</p>

<p>/usr should also be around 10G</p>

<p>Create a group in /etc/group entitled &#8220;builders&#8221; and add the non-privileged user</p>

<p>builders:*:32768:</p>

<p>A new login class entitled &#8220;builders&#8221; for the builders group is created, limits dropped in /etc/login.conf and the file is regenerated and the build user is added to the group.</p>

<p>builders:
 :datasize-cur=infinity:
 :datasize-max=infinity:
 :filesize-max=infinity:
 :stacksize-max=infinity:
 :maxproc-max=infinity:
 :maxproc-cur=256:
 :memorylocked-max=infinity:
 :openfiles-max=infinity:
 :tc=default:</p>

<ul>
<li>Populate the ports tree with:</li>
</ul>

<p>cd /usr &amp;&amp; cvs -d anoncvs@anoncvs.comstyle.com:/cvs get -P ports</p>

<ul>
<li>Install Git, Tor and Torsocks packages, the latter two assuming GitHub&#8217; pulls are accessed over Tor. At this end of the install, there will be many, many more packages installed.</li>
</ul>

<p>pkg_add -r git</p>

<p>pkg_add -r tor</p>

<p>pkg_add -r torsocks</p>

<ul>
<li>Clone Tor Browser repository</li>
</ul>

<p>cd /usr/ports/mystuff &amp;&amp; git clone https://github.com/torbsd/openbsd-ports</p>

<ul>
<li>Future Builds</li>
</ul>

<p>As the Tor Browser port is in regular development, keeping the port builds updated requires updating the OpenBSD snapshot in use, the ports tree and Tor Browser repository on GitHub. Note that after the required dependencies are installed, subsequent Tor Browser builds will be significantly faster.</p>

<ul>
<li><p>To keep the ports tree updated after the initial checkout:
cd /usr/ports &amp;&amp; cvs up -Pd</p></li>
<li><p>To update Github&#8217;s openbsd-ports repository:
cd /usr/ports/mystuff &amp;&amp; git pull</p></li>
</ul>

<p>? make -j .. time(1)</p>

<p>pkg_create(1)</p>

</body>
</html>
